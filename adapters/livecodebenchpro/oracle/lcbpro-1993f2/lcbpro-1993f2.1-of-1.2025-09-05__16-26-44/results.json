{
    "id": "7c2a09f6-28b6-4db9-9080-e7edf7c9e34b",
    "trial_name": "lcbpro-1993f2.1-of-1.2025-09-05__16-26-44",
    "task_id": "lcbpro-1993f2",
    "instruction": "LiveCodeBench Pro (Mini) - external judge.\n\nThe agent must create a C++17 solution file at /app/main.cpp.\nThis task does not include local test cases. Instead, the test harness:\n  1) POSTs the code to the external judge (/submit) to get a sid,\n  2) polls GET /result/{sid}?short=1 until status == \"done\",\n  3) passes only if the judge returns passed == true.\n\nEnvironment variables (overridable at runtime):\n  - BASE_URL: judge base URL (default http://38.80.122.117:8081)\n  - PID: problem id (default 1993F2)\n  - LANG: language (default cpp)\n  - CODE_PATH: path to code (default /app/main.cpp)\n  - JUDGE_TIMEOUT_SECS: poll timeout seconds (default 120)\n\nThis is the hard version of the problem. The only difference is that in this version $k \\le 10^{12}$. You can make hacks only if both versions of the problem are solved.\n\nGiven a $w \\times h$ rectangle on the $Oxy$ plane, with points $(0, 0)$ at the bottom-left and $(w, h)$ at the top-right of the rectangle.\n\nYou also have a robot initially at point $(0, 0)$ and a script $s$ of $n$ characters. Each character is either L, R, U, or D, which tells the robot to move left, right, up, or down respectively.\n\nThe robot can only move inside the rectangle; otherwise, it will change the script $s$ as follows:\n\n- If it tries to move outside a vertical border, it changes all L characters to R's (and vice versa, all R's to L's).\n- If it tries to move outside a horizontal border, it changes all U characters to D's (and vice versa, all D's to U's).\n\nThen, it will execute the changed script starting from the character which it couldn't execute.\n\n![](https://espresso.codeforces.com/44058d13574b8a336b6b4ffc319b349c0a98032e.png)An example of the robot's movement process, $s = \\texttt{\"ULULURD\"}$\n\nThe script $s$ will be executed for $k$ times continuously. All changes to the string $s$ will be retained even when it is repeated. During this process, how many times will the robot move to the point $(0, 0)$ in total? Note that the initial position does NOT count.\n\n### Input\n\nThe first line contains a single integer $t$ ($1 \\le t \\le 10^4$) -- the number of test cases.\n\nThe first line of each test case contains four integers $n$, $k$, $w$, and $h$ ($1 \\le n, w, h \\le 10^6$; $1 \\le k \\le 10^{12}$).\n\nThe second line contains a single string $s$ of size $n$ ($s_i \\in \\{\\texttt{L}, \\texttt{R}, \\texttt{U}, \\texttt{D}\\}$) -- the script to be executed.\n\nIt is guaranteed that the sum of $n$ over all test cases does not exceed $10^6$.\n\n### Output\n\nFor each test case, print a single integer -- the number of times the robot reaches $(0, 0)$ when executing script $s$ for $k$ times continuously.\n\n### Example\n\n#### Input #1\n\n```\n\n6\n\n2 4 2 2\n\nUR\n\n4 2 1 1\n\nLLDD\n\n6 3 3 1\n\nRLRRRL\n\n5 6 3 3\n\nRUURD\n\n7 5 3 4\n\nRRDLUUU\n\n7 123456789999 3 2\n\nULULURD\n\n```\n\n#### Output #1\n\n```\n1\n4\n3\n1\n1\n41152263332\n```\n\n### Note\n\nIn the first test case, the robot only moves up and right for the first two executions. After that, it occupies the position $(2, 2)$. For the next two executions, it moves down and left and finishes at $(0, 0)$. So the answer is $1$.\n\nIn the second test case, each time executing the script the robot visits the origin twice. And since $k=2$, it visits the origin $2 \\cdot 2 = 4$ times overall.\n\n![](https://espresso.codeforces.com/4fc54bd5ef19b611fe31366a3ac8c0ccfa7bf1f1.png)\n\nIn the third test case, the visualization is shown as below:\n\n![](https://espresso.codeforces.com/fbf49c7b363f655844f0192b2cbc3766a46aaa29.png)",
    "is_resolved": true,
    "failure_mode": "unset",
    "parser_results": {
        "test_external_judge": "passed"
    },
    "recording_path": "2025-09-05__16-26-44/lcbpro-1993f2/lcbpro-1993f2.1-of-1.2025-09-05__16-26-44/sessions/agent.cast",
    "total_input_tokens": 0,
    "total_output_tokens": 0,
    "trial_started_at": "2025-09-05T23:36:11.000464+00:00",
    "trial_ended_at": "2025-09-05T23:36:53.338224+00:00",
    "agent_started_at": "2025-09-05T23:36:23.422143+00:00",
    "agent_ended_at": "2025-09-05T23:36:24.278252+00:00",
    "test_started_at": "2025-09-05T23:36:27.302122+00:00",
    "test_ended_at": "2025-09-05T23:36:36.586147+00:00"
}