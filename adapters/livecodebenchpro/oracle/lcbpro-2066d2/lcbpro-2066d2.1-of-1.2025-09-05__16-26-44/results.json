{
    "id": "a4654238-e4bc-4ccc-b305-67ae6a60a5ed",
    "trial_name": "lcbpro-2066d2.1-of-1.2025-09-05__16-26-44",
    "task_id": "lcbpro-2066d2",
    "instruction": "LiveCodeBench Pro (Mini) - external judge.\n\nThe agent must create a C++17 solution file at /app/main.cpp.\nThis task does not include local test cases. Instead, the test harness:\n  1) POSTs the code to the external judge (/submit) to get a sid,\n  2) polls GET /result/{sid}?short=1 until status == \"done\",\n  3) passes only if the judge returns passed == true.\n\nEnvironment variables (overridable at runtime):\n  - BASE_URL: judge base URL (default http://38.80.122.117:8081)\n  - PID: problem id (default 2066D2)\n  - LANG: language (default cpp)\n  - CODE_PATH: path to code (default /app/main.cpp)\n  - JUDGE_TIMEOUT_SECS: poll timeout seconds (default 120)\n\nThis is the hard version of the problem. The difference between the versions is that in this version, not necessary $a_i = 0$. You can hack only if you solved all versions of this problem.\n\nThere is a building with $n$ floors, numbered from $1$ to $n$ from bottom to top. There is exactly one person living on each floor.\n\nAll the residents of the building have an important goal today: to launch at least $c$ paper airplanes collectively. The residents will launch the airplanes in turn. When a person from the $i$-th floor launches an airplane, all residents on floors from $1$ to $i$ can see it as it descends to the ground. If, from the perspective of the resident on the $i$-th floor, at least $c$ airplanes have already been launched, they will no longer launch airplanes themselves. It is also known that by the end of the day, from the perspective of each resident in the building, at least $c$ airplanes have been launched, and a total of $m$ airplanes were thrown.\n\nYou have been carefully monitoring this flash mob, and for each airplane, you recorded which resident from which floor threw it. Unfortunately, the information about who exactly threw some of the airplanes has been lost. Find the number of ways to fill in the gaps so that the information could be credible. Since the answer could be quite large, output it modulo $10^9 + 7$.\n\nIt is also possible that you made a mistake in your records, and there is no possible way to restore the gaps. In that case, the answer is considered to be $0$.\n\n### Input\n\nEach test contains multiple test cases. The first line contains the number of test cases $t$ ($1 \\le t \\le 10^4$). The description of the test cases follows.\n\nThe first line of each test case contains three integers $n, c, m$ ($1 \\le n \\le 100$, $1 \\le c \\le 100$, $c \\le m \\le n \\cdot c$) -- the number of floors in the building, the minimum required number of airplanes, and the number of airplanes actually launched.\n\nThe second line of each test case contains $m$ integers $a_1, a_2, \\ldots, a_m$ ($0 \\le a_i \\le n$) -- $a_i$ indicates the resident from which floor launched the $i$-th airplane; $a_i = 0$ indicates a gap.\n\nIt is guaranteed that the sum of the values of $m$ across all test cases does not exceed $10^4$.\n\n### Output\n\nFor each test case, output the number of ways to fill in the gaps with numbers from $1$ to $n$, so that the chronology of the airplane launches could be credible, modulo $10^9 + 7$.\n\n### Example\n\n#### Input #1\n\n```\n\n8\n\n3 2 4\n\n0 0 0 0\n\n5 5 7\n\n0 0 0 0 0 0 0\n\n6 1 3\n\n2 0 0\n\n2 3 5\n\n0 0 1 0 2\n\n3 3 4\n\n3 3 3 0\n\n2 1 2\n\n0 1\n\n2 1 2\n\n0 2\n\n5 3 12\n\n0 0 1 0 2 4 0 0 0 5 0 5\n\n```\n\n#### Output #1\n\n```\n6\n190\n3\n2\n0\n0\n1\n14\n```\n\n### Note\n\nIn the first test example, all six possible ways to fill in the gaps are as follows:\n\n1. $[1, 1, 3, 3]$\n2. $[1, 2, 3, 3]$\n3. $[1, 3, 2, 3]$\n4. $[2, 1, 3, 3]$\n5. $[2, 2, 3, 3]$\n6. $[3, 1, 2, 3]$\n\nNote that the array $[2, 3, 1, 3]$ is not a valid way to fill in the gaps, as the third airplane could not have been launched by the person on the $1$st floor, since from their perspective, $c = 2$ airplanes had already been launched.\n\nAlso, the array $[1, 1, 2, 3]$ is not a valid way to fill in the gaps, as from the perspective of the person on the $3$rd floor, only $1$ airplane has been launched, while $c = 2$.",
    "is_resolved": true,
    "failure_mode": "unset",
    "parser_results": {
        "test_external_judge": "passed"
    },
    "recording_path": "2025-09-05__16-26-44/lcbpro-2066d2/lcbpro-2066d2.1-of-1.2025-09-05__16-26-44/sessions/agent.cast",
    "total_input_tokens": 0,
    "total_output_tokens": 0,
    "trial_started_at": "2025-09-05T23:36:11.799616+00:00",
    "trial_ended_at": "2025-09-05T23:36:56.145168+00:00",
    "agent_started_at": "2025-09-05T23:36:24.130184+00:00",
    "agent_ended_at": "2025-09-05T23:36:24.863402+00:00",
    "test_started_at": "2025-09-05T23:36:27.446245+00:00",
    "test_ended_at": "2025-09-05T23:36:42.555558+00:00"
}