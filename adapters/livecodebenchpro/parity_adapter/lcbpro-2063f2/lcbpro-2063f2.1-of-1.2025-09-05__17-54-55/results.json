{
    "id": "cdd01112-698e-4b74-9992-41c75aa78fca",
    "trial_name": "lcbpro-2063f2.1-of-1.2025-09-05__17-54-55",
    "task_id": "lcbpro-2063f2",
    "instruction": "LiveCodeBench Pro (Mini) - external judge.\n\nThe agent must create a C++17 solution file at /app/main.cpp.\nThis task does not include local test cases. Instead, the test harness:\n  1) POSTs the code to the external judge (/submit) to get a sid,\n  2) polls GET /result/{sid}?short=1 until status == \"done\",\n  3) passes only if the judge returns passed == true.\n\nEnvironment variables (overridable at runtime):\n  - BASE_URL: judge base URL (default http://38.80.122.117:8081)\n  - PID: problem id (default 2063F2)\n  - LANG: language (default cpp)\n  - CODE_PATH: path to code (default /app/main.cpp)\n  - JUDGE_TIMEOUT_SECS: poll timeout seconds (default 120)\n\nThis is the hard version of the problem. The difference between the versions is that in this version, the limits on $t$ and $n$ are bigger. You can hack only if you solved all versions of this problem.\n\nNow Little John is rich, and so he finally buys a house big enough to fit himself and his favorite bracket sequence. But somehow, he ended up with a lot of brackets! Frustrated, he penetrates through the ceiling with the \"buddha palm\".\n\nA bracket sequence is called balanced if it can be constructed by the following formal grammar.\n\n1. The empty sequence $\\varnothing$ is balanced.\n2. If the bracket sequence $A$ is balanced, then $\\mathtt{(}A\\mathtt{)}$ is also balanced.\n3. If the bracket sequences $A$ and $B$ are balanced, then the concatenated sequence $A B$ is also balanced.\n\nFor example, the sequences \"(())()\", \"()\", \"(()(()))\", and the empty sequence are balanced, while \"(()\" and \"(()))(\" are not.\n\nGiven a balanced bracket sequence $s$, a pair of indices $(i,j)$ ($i<j$) is called a good pair if $s_i$ is '(', $s_j$ is ')', and the two brackets are added simultaneously with respect to Rule 2 while constructing the sequence $s$. For example, the sequence \"(())()\" has three different good pairs, which are $(1,4)$, $(2,3)$, and $(5,6)$. One can show that any balanced bracket sequence of $2n$ brackets contains exactly $n$ different good pairs, and using any order of rules to construct the same bracket sequence will yield the same set of good pairs.\n\nEmily will play a bracket guessing game with John. The game is played as follows.\n\nInitially, John has a balanced bracket sequence $s$ containing $n$ different good pairs, which is not known to Emily. John tells Emily the value of $n$ and asks Emily to guess the sequence.\n\nThroughout $n$ turns, John gives Emily the following kind of clue on each turn.\n\n- $l\\;r$: The sequence $s$ contains a good pair $(l,r)$.\n\nThe clues that John gives Emily are pairwise distinct and do not contradict each other.\n\nAt a certain point, Emily can be certain that the balanced bracket sequence satisfying the clues given so far is unique. For example, assume Emily knows that $s$ has $3$ good pairs, and it contains the good pair $(2,5)$. Out of $5$ balanced bracket sequences with $3$ good pairs, there exists only one such sequence \"((()))\" with the good pair $(2,5)$. Therefore, one can see that Emily does not always need $n$ turns to guess $s$.\n\nTo find out the content of $s$ as early as possible, Emily wants to know the number of different balanced bracket sequences that match the clues after each turn. Surely, this is not an easy job for Emily, especially when she is given so many good pairs. Now it is your turn to help Emily. Given the clues, you must find the answer before and after each turn. As the answers may be huge, you need to find them modulo $998\\,244\\,353$.\n\n### Input\n\nEach test contains multiple test cases. The first line contains the number of test cases $t$ ($1 \\le t \\le 10^4$). The description of the test cases follows.\n\nThe first line of each test case contains one integer $n$ ($2 \\le n \\le 3 \\cdot 10^5$)Â -- the number of good pairs.\n\nThen, each of the $n$ following lines contains two integers $l_i$ and $r_i$ representing the $i$-th clue ($1 \\le l_i < r_i \\le 2n$).\n\nThe clues in one test case are pairwise distinct and do not contradict each other.\n\nIt is guaranteed that the sum of $n$ over all test cases does not exceed $3 \\cdot 10^5$.\n\n### Output\n\nFor each test case, output $n+1$ integers on a separate line:\n\n- The first integer is the answer before all clues, modulo $998\\,244\\,353$.\n- For all $i \\ge 1$, the $i+1$-th integer is the answer after the $i$-th clue, modulo $998\\,244\\,353$.\n\n### Example\n\n#### Input #1\n\n```\n\n3\n\n3\n\n2 5\n\n1 6\n\n3 4\n\n4\n\n1 6\n\n7 8\n\n2 3\n\n4 5\n\n6\n\n2 3\n\n1 6\n\n7 8\n\n9 12\n\n10 11\n\n4 5\n\n```\n\n#### Output #1\n\n```\n5 1 1 1\n14 2 2 1 1\n132 42 5 2 1 1 1\n```\n\n### Note\n\nThe first test case of the example is explained in the problem description.\n\nThe third test case of the example is explained as follows. It can be shown that there are $132$ balanced bracket sequences with $6$ good pairs. The answers after each clue are given as follows:\n\n1. You are given the good pair $(2,3)$. There are $42$ balanced bracket sequences having the good pair $(2,3)$.\n2. You are given the good pair $(1,6)$. There are $5$ balanced bracket sequences having good pairs $(2,3)$, $(1,6)$.\n3. You are given the good pair $(7,8)$. There are $2$ balanced bracket sequences having the three good pairs. The strings are \"(()())()(())\" and \"(()())()()()\", respectively.\n4. You are given the good pair $(9,12)$. There is only one balanced bracket sequence having the four good pairs. The content of $s$ is therefore the only string, which is \"(()())()(())\".\n\nThen, the number of bracket sequences after the fifth and the sixth clue are both $1$ as you already know the content of $s$.",
    "is_resolved": false,
    "failure_mode": "unset",
    "parser_results": {
        "test_external_judge": "failed"
    },
    "recording_path": "2025-09-05__17-54-55/lcbpro-2063f2/lcbpro-2063f2.1-of-1.2025-09-05__17-54-55/sessions/agent.cast",
    "total_input_tokens": 1713,
    "total_output_tokens": 1768,
    "trial_started_at": "2025-09-06T01:36:09.393810+00:00",
    "trial_ended_at": "2025-09-06T01:39:17.258282+00:00",
    "agent_started_at": "2025-09-06T01:36:32.170693+00:00",
    "agent_ended_at": "2025-09-06T01:36:57.063853+00:00",
    "test_started_at": "2025-09-06T01:36:59.786868+00:00",
    "test_ended_at": "2025-09-06T01:39:02.411651+00:00"
}