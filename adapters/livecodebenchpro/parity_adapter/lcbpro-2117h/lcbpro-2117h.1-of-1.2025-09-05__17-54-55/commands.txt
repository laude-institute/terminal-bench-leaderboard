['asciinema rec --stdin /logs/agent.cast', 'Enter']
['clear', 'Enter']
["echo 'I2luY2x1ZGUgPGJpdHMvc3RkYysrLmg+CnVzaW5nIG5hbWVzcGFjZSBzdGQ7CgovLyBTZWdtZW50IFRyZWUgZm9yIGZyZXF1ZW5jeSBjb3VudGluZwovLyBXZSBtYWludGFpbiBmb3IgZWFjaCBzZWdtZW50IHRoZSBjYW5kaWRhdGUgZWxlbWVudCB0aGF0IGNvdWxkIGJlIGEgbWFqb3JpdHkgYW5kIGl0cyBmcmVxdWVuY3kgb2Zmc2V0CgpzdHJ1Y3QgTm9kZSB7CiAgICBpbnQgY2FuZGlkYXRlOwogICAgaW50IGZyZXE7CiAgICBOb2RlKGludCBjID0gLTEsIGludCBmID0gMCkgOiBjYW5kaWRhdGUoYyksIGZyZXEoZikge30KfTsKCk5vZGUgbWVyZ2UoY29uc3QgTm9kZSAmYSwgY29uc3QgTm9kZSAmYikgewogICAgaWYgKGEuY2FuZGlkYXRlID09IC0xKSByZXR1cm4gYjsKICAgIGlmIChiLmNhbmRpZGF0ZSA9PSAtMSkgcmV0dXJuIGE7CiAgICBpZiAoYS5jYW5kaWRhdGUgPT0gYi5jYW5kaWRhdGUpIHJldHVybiBOb2RlKGEuY2FuZGlkYXRlLCBhLmZyZXEgKyBiLmZyZXEpOwogICAgaWYgKGEuZnJlcSA+IGIuZnJlcSkgcmV0dXJuIE5vZGUoYS5jYW5kaWRhdGUsIGEuZnJlcSAtIGIuZnJlcSk7CiAgICBlbHNlIHJldHVybiBOb2RlKGIuY2FuZGlkYXRlLCBiLmZyZXEgLSBhLmZyZXEpOwp9CgpzdHJ1Y3QgU2VnbWVudFRyZWUgewogICAgaW50IG47CiAgICB2ZWN0b3I8Tm9kZT4gdHJlZTsKCiAgICBTZWdtZW50VHJlZShpbnQgc2l6ZSkgOiBuKHNpemUpIHsKICAgICAgICB0cmVlLmFzc2lnbig0ICogbiwgTm9kZSgpKTsKICAgIH0KCiAgICB2b2lkIGJ1aWxkKGNvbnN0IHZlY3RvcjxpbnQ+ICZhLCBpbnQgaWR4LCBpbnQgbCwgaW50IHIpIHsKICAgICAgICBpZiAobCA9PSByKSB7CiAgICAgICAgICAgIHRyZWVbaWR4XSA9IE5vZGUoYVtsXSwgMSk7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaW50IG0gPSAobCArIHIpIC8gMjsKICAgICAgICBidWlsZChhLCAyICogaWR4LCBsLCBtKTsKICAgICAgICBidWlsZChhLCAyICogaWR4ICsgMSwgbSArIDEsIHIpOwogICAgICAgIHRyZWVbaWR4XSA9IG1lcmdlKHRyZWVbMiAqIGlkeF0sIHRyZWVbMiAqIGlkeCArIDFdKTsKICAgIH0KCiAgICB2b2lkIGJ1aWxkKGNvbnN0IHZlY3RvcjxpbnQ+ICZhKSB7CiAgICAgICAgYnVpbGQoYSwgMSwgMCwgbiAtIDEpOwogICAgfQoKICAgIHZvaWQgdXBkYXRlKGludCBpZHgsIGludCBsLCBpbnQgciwgaW50IHBvcywgaW50IHZhbCkgewogICAgICAgIGlmIChsID09IHIpIHsKICAgICAgICAgICAgdHJlZVtpZHhdID0gTm9kZSh2YWwsIDEpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGludCBtID0gKGwgKyByKSAvIDI7CiAgICAgICAgaWYgKHBvcyA8PSBtKSB1cGRhdGUoMiAqIGlkeCwgbCwgbSwgcG9zLCB2YWwpOwogICAgICAgIGVsc2UgdXBkYXRlKDIgKiBpZHggKyAxLCBtICsgMSwgciwgcG9zLCB2YWwpOwogICAgICAgIHRyZWVbaWR4XSA9IG1lcmdlKHRyZWVbMiAqIGlkeF0sIHRyZWVbMiAqIGlkeCArIDFdKTsKICAgIH0KCiAgICB2b2lkIHVwZGF0ZShpbnQgcG9zLCBpbnQgdmFsKSB7CiAgICAgICAgdXBkYXRlKDEsIDAsIG4gLSAxLCBwb3MsIHZhbCk7CiAgICB9CgogICAgTm9kZSBxdWVyeShpbnQgaWR4LCBpbnQgbCwgaW50IHIsIGludCBxbCwgaW50IHFyKSB7CiAgICAgICAgaWYgKHFsID4gciB8fCBxciA8IGwpIHJldHVybiBOb2RlKCk7CiAgICAgICAgaWYgKHFsIDw9IGwgJiYgciA8PSBxcikgcmV0dXJuIHRyZWVbaWR4XTsKICAgICAgICBpbnQgbSA9IChsICsgcikgLyAyOwogICAgICAgIHJldHVybiBtZXJnZShxdWVyeSgyICogaWR4LCBsLCBtLCBxbCwgcXIpLCBxdWVyeSgyICogaWR4ICsgMSwgbSArIDEsIHIsIHFsLCBxcikpOwogICAgfQoKICAgIE5vZGUgcXVlcnkoaW50IHFsLCBpbnQgcXIpIHsKICAgICAgICByZXR1cm4gcXVlcnkoMSwgMCwgbiAtIDEsIHFsLCBxcik7CiAgICB9Cn07CgovLyBXZSBzdG9yZSBwb3NpdGlvbnMgb2YgZWFjaCBlbGVtZW50IGZvciBxdWljayBmcmVxdWVuY3kgY2FsY3VsYXRpb24KLy8gVXNpbmcgYmluYXJ5IHNlYXJjaCB0byBjb3VudCBvY2N1cnJlbmNlcyBpbiBhIHJhbmdlCgpzdHJ1Y3QgRnJlcXVlbmN5VHJhY2tlciB7CiAgICB2ZWN0b3I8dmVjdG9yPGludD4+IHBvc2l0aW9uczsKCiAgICBGcmVxdWVuY3lUcmFja2VyKGludCBuKSA6IHBvc2l0aW9ucyhuICsgMSkge30KCiAgICB2b2lkIGFkZChpbnQgdmFsLCBpbnQgcG9zKSB7CiAgICAgICAgcG9zaXRpb25zW3ZhbF0ucHVzaF9iYWNrKHBvcyk7CiAgICB9CgogICAgdm9pZCByZW1vdmUoaW50IHZhbCwgaW50IHBvcykgewogICAgICAgIC8vIFdlJ2xsIG5vdCByZW1vdmUgZnJvbSB2ZWN0b3IgYnV0IHJlbHkgb24gdXBkYXRlcyB0byBzZWdtZW50IHRyZWUKICAgIH0KCiAgICBpbnQgY291bnQoaW50IHZhbCwgaW50IGwsIGludCByKSB7CiAgICAgICAgaWYgKHZhbCA+IChpbnQpcG9zaXRpb25zLnNpemUoKSAtIDEpIHJldHVybiAwOwogICAgICAgIGNvbnN0IGF1dG8gJnZlYyA9IHBvc2l0aW9uc1t2YWxdOwogICAgICAgIGludCBsZWZ0ID0gKGludCkoc3RkOjpsb3dlcl9ib3VuZCh2ZWMuYmVnaW4oKSwgdmVjLmVuZCgpLCBsKSAtIHZlYy5iZWdpbigpKTsKICAgICAgICBpbnQgcmlnaHQgPSAoaW50KShzdGQ6OnVwcGVyX2JvdW5kKHZlYy5iZWdpbigpLCB2ZWMuZW5kKCksIHIpIC0gdmVjLmJlZ2luKCkpOwogICAgICAgIHJldHVybiByaWdodCAtIGxlZnQ7CiAgICB9CgogICAgdm9pZCB1cGRhdGUoaW50IHZhbCwgaW50IG9sZFBvcywgaW50IG5ld1BvcykgewogICAgICAgIC8vIFRvIGtlZXAgY29kZSBzaW1wbGUsIHdlIHdvbid0IHJlbW92ZSBvbGRQb3MgZnJvbSBwb3NpdGlvbnNbdmFsXS4KICAgICAgICAvLyBJbnN0ZWFkLCB3ZSByZWx5IG9uIHNlZ21lbnQgdHJlZSBjb3JyZWN0bmVzcyBhbmQgcG9zaXRpb24gcXVlcmllcyBmb3IgZnJlcXVlbmN5LgogICAgICAgIC8vIFRoaXMgd29ya3MgYmVjYXVzZSB3ZSBhbHdheXMgcXVlcnkgZXhhY3QgcG9zaXRpb25zIGZvciBmcmVxdWVuY3kgY2hlY2tzLgogICAgICAgIGlmIChuZXdQb3MgIT0gLTEpIHBvc2l0aW9uc1t2YWxdLnB1c2hfYmFjayhuZXdQb3MpOwogICAgfQp9OwoKaW50IG1haW4oKSB7CiAgICBpb3M6OnN5bmNfd2l0aF9zdGRpbyhmYWxzZSk7CiAgICBjaW4udGllKG51bGxwdHIpOwoKICAgIGludCB0OyBjaW4gPj4gdDsKICAgIHdoaWxlICh0LS0pIHsKICAgICAgICBpbnQgbiwgcTsgY2luID4+IG4gPj4gcTsKICAgICAgICB2ZWN0b3I8aW50PiBhKG4pOwogICAgICAgIGZvciAoaW50IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICAgIGNpbiA+PiBhW2ldOwogICAgICAgIH0KCiAgICAgICAgLy8gQnVpbGQgc2VnbWVudCB0cmVlCiAgICAgICAgU2VnbWVudFRyZWUgc2VnKG4pOwogICAgICAgIHNlZy5idWlsZChhKTsKCiAgICAgICAgLy8gRnJlcXVlbmN5IHBvc2l0aW9ucwogICAgICAgIHZlY3Rvcjx2ZWN0b3I8aW50Pj4gcG9zaXRpb25zKG4gKyAxKTsKICAgICAgICBmb3IgKGludCBpID0gMDsgaSA8IG47IGkrKykgewogICAgICAgICAgICBwb3NpdGlvbnNbYVtpXV0ucHVzaF9iYWNrKGkpOwogICAgICAgIH0KCiAgICAgICAgYXV0byBjb3VudF9vY2N1cnJlbmNlcyA9IFsmXShpbnQgdmFsLCBpbnQgbCwgaW50IHIpIHsKICAgICAgICAgICAgaWYgKHZhbCA8IDEgfHwgdmFsID4gbikgcmV0dXJuIDA7CiAgICAgICAgICAgIGNvbnN0IGF1dG8gJnZlYyA9IHBvc2l0aW9uc1t2YWxdOwogICAgICAgICAgICBpbnQgbGVmdCA9IChpbnQpKHN0ZDo6bG93ZXJfYm91bmQodmVjLmJlZ2luKCksIHZlYy5lbmQoKSwgbCkgLSB2ZWMuYmVnaW4oKSk7CiAgICAgICAgICAgIGludCByaWdodCA9IChpbnQpKHN0ZDo6dXBwZXJfYm91bmQodmVjLmJlZ2luKCksIHZlYy5lbmQoKSwgcikgLSB2ZWMuYmVnaW4oKSk7CiAgICAgICAgICAgIHJldHVybiByaWdodCAtIGxlZnQ7CiAgICAgICAgfTsKCiAgICAgICAgLy8gRm9yIHVwZGF0ZXMsIHdlIG5lZWQgdG8gdXBkYXRlIHBvc2l0aW9ucyB2ZWN0b3IKICAgICAgICAvLyBBY3R1YWxseSwgd2Ugd2lsbCBtYWludGFpbiBwb3NpdGlvbnMgYXMgc29ydGVkIHZlY3RvcnMKICAgICAgICAvLyBPbiB1cGRhdGUsIHdlIHJlbW92ZSBvbGQgcG9zaXRpb24gYW5kIGFkZCBuZXcgcG9zaXRpb24KICAgICAgICAvLyBUbyBzdXBwb3J0IGZhc3QgcmVtb3ZlLCB3ZSB1c2UgbXVsdGlzZXQgb3IgYmFsYW5jZWQgdHJlZQogICAgICAgIC8vIEJ1dCB0aGF0IHdpbGwgYmUgY29tcGxpY2F0ZWQsIHNvIHdlIHVzZSBhIGJhbGFuY2VkIGJpbmFyeSBpbmRleGVkIHRyZWUgb3Igc2VnbWVudCB0cmVlCiAgICAgICAgLy8gSG93ZXZlciwgbWVtb3J5IGFuZCBjb21wbGV4aXR5IGNvbnN0cmFpbnRzIG1ha2UgaXQgaGFyZAogICAgICAgIC8vIEluc3RlYWQsIHdlIGNhbiB1c2Ugc3RkOjptdWx0aXNldCBmb3IgZWFjaCB2YWx1ZQoKICAgICAgICB2ZWN0b3I8bXVsdGlzZXQ8aW50Pj4gcG9zU2V0cyhuICsgMSk7CiAgICAgICAgZm9yIChpbnQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgICAgcG9zU2V0c1thW2ldXS5pbnNlcnQoaSk7CiAgICAgICAgfQoKICAgICAgICBhdXRvIGNudF9mcmVxID0gWyZdKGludCB2YWwsIGludCBsLCBpbnQgcikgLT4gaW50IHsKICAgICAgICAgICAgaWYgKHZhbCA8IDEgfHwgdmFsID4gbikgcmV0dXJuIDA7CiAgICAgICAgICAgIGNvbnN0IGF1dG8gJm1zID0gcG9zU2V0c1t2YWxdOwogICAgICAgICAgICBhdXRvIGxlZnRfaXQgPSBtcy5sb3dlcl9ib3VuZChsKTsKICAgICAgICAgICAgYXV0byByaWdodF9pdCA9IG1zLnVwcGVyX2JvdW5kKHIpOwogICAgICAgICAgICByZXR1cm4gZGlzdGFuY2UobGVmdF9pdCwgcmlnaHRfaXQpOwogICAgICAgIH07CgogICAgICAgIHZlY3RvcjxpbnQ+IHJlczsKCiAgICAgICAgZm9yIChpbnQgXyA9IDA7IF8gPCBxOyBfKyspIHsKICAgICAgICAgICAgaW50IGksIHg7IGNpbiA+PiBpID4+IHg7IGktLTsKICAgICAgICAgICAgLy8gVXBkYXRlIHNlZ21lbnQgdHJlZQogICAgICAgICAgICBpbnQgb2xkX3ZhbCA9IGFbaV07CiAgICAgICAgICAgIGFbaV0gPSB4OwogICAgICAgICAgICBzZWcudXBkYXRlKGksIHgpOwoKICAgICAgICAgICAgLy8gVXBkYXRlIHBvc1NldHMKICAgICAgICAgICAgcG9zU2V0c1tvbGRfdmFsXS5lcmFzZShwb3NTZXRzW29sZF92YWxdLmZpbmQoaSkpOwogICAgICAgICAgICBwb3NTZXRzW3hdLmluc2VydChpKTsKCiAgICAgICAgICAgIC8vIFF1ZXJ5IGNhbmRpZGF0ZSBmb3Igd2hvbGUgYXJyYXkKICAgICAgICAgICAgTm9kZSBjYW5kID0gc2VnLnF1ZXJ5KDAsIG4gLSAxKTsKICAgICAgICAgICAgaW50IGNhbmRpZGF0ZSA9IGNhbmQuY2FuZGlkYXRlOwoKICAgICAgICAgICAgaWYgKGNhbmRpZGF0ZSA9PSAtMSkgewogICAgICAgICAgICAgICAgcmVzLnB1c2hfYmFjaygwKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBXZSB0cnkgdG8gZmluZCBtYXggayBieSBjaG9vc2luZyBzdWJhcnJheSB3aGVyZSBjYW5kaWRhdGUgZnJlcXVlbmN5IGlzIG1heGltaXplZAogICAgICAgICAgICAvLyBUaGUgbWF4aW11bSBwb3NzaWJsZSBmcmVxIG9mIGNhbmRpZGF0ZSBpbiBhbnkgc3ViYXJyYXkgaXMgdGhlIG1heGltdW0gbGVuZ3RoIG9mIHN1YmFycmF5IHdoZXJlIGZyZXEoY2FuZGlkYXRlKSBpcyBtYXgKICAgICAgICAgICAgLy8gQnV0IHdlIHdhbnQgdG8gZmluZCBtYXggayBzLnQuIHRoZXJlIGV4aXN0cyBhIHN1YmFycmF5IGIgd2l0aCBjYW5kaWRhdGUgZnJlcShiKSA+PSBmbG9vcih8YnwrMSkvMiArIGsKCiAgICAgICAgICAgIC8vIEJpbmFyeSBzZWFyY2ggb24gbGVuZ3RoIG9mIHN1YmFycmF5IHRvIGZpbmQgbWF4aW11bSBrCiAgICAgICAgICAgIC8vIEJ1dCBwcm9ibGVtIGFza3MgbWF4aW11bSBrIG92ZXJhbGwKCiAgICAgICAgICAgIC8vIEFjdHVhbGx5LCB0aGUgcHJvYmxlbSBjYW4gYmUgc2ltcGxpZmllZCBhczoKICAgICAgICAgICAgLy8gRm9yIGNhbmRpZGF0ZSBlbGVtZW50IHgsIG1heCBrID0gbWF4IG92ZXIgYWxsIHN1YmFycmF5cyBvZiBmcmVxKHgpIC0gZmxvb3IoKGxlbmd0aCsxKS8yKQogICAgICAgICAgICAvLyBTaW5jZSBmbG9vcigobGVuZ3RoKzEpLzIpIDw9IChsZW5ndGgrMSkvMiwgZGVmaW5lIGZvciBzdWJhcnJheSBsZW5ndGggbGVuIGFuZCBmcmVxIGY6CiAgICAgICAgICAgIC8vIGsgPD0gZiAtIGZsb29yKChsZW4rMSkvMikKICAgICAgICAgICAgLy8gV2Ugd2FudCB0byBtYXhpbWl6ZSBrCgogICAgICAgICAgICAvLyBUbyBmaW5kIG1heGltdW0gazoKICAgICAgICAgICAgLy8gV2UgY2FuIHRyeSBhbGwgb2NjdXJyZW5jZXMgb2YgY2FuZGlkYXRlIGFuZCBmaW5kIG1heGltYWwgZGlmZmVyZW5jZSBiZXR3ZWVuIGNvdW50IGFuZCBoYWxmIGxlbmd0aAoKICAgICAgICAgICAgLy8gTGV0J3MgZmluZCB0aGUgbWF4aW11bSBrIGJ5IGNoZWNraW5nIGludGVydmFscyBiZXR3ZWVuIG9jY3VycmVuY2VzIG9mIGNhbmRpZGF0ZQoKICAgICAgICAgICAgY29uc3QgYXV0byAmY2FuZF9wb3MgPSBwb3NTZXRzW2NhbmRpZGF0ZV07CiAgICAgICAgICAgIGlmIChjYW5kX3Bvcy5lbXB0eSgpKSB7CiAgICAgICAgICAgICAgICByZXMucHVzaF9iYWNrKDApOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIFdlJ2xsIGF0dGVtcHQgdG8gZmluZCB0aGUgbWF4aW11bSBrIGJ5IHNjYW5uaW5nIGNhbmRpZGF0ZSBwb3NpdGlvbnMKICAgICAgICAgICAgLy8gVGhlIGxhcmdlc3QgayBpcyBmcmVxIC0gZmxvb3IoKGxlbisxKS8yKQoKICAgICAgICAgICAgLy8gVXNlIHR3byBwb2ludGVycyB0byBmaW5kIHN1YmFycmF5IHdpdGggbWF4IGsKCiAgICAgICAgICAgIHZlY3RvcjxpbnQ+IHBvc2l0aW9uc192ZWMoY2FuZF9wb3MuYmVnaW4oKSwgY2FuZF9wb3MuZW5kKCkpOwoKICAgICAgICAgICAgaW50IG1heF9rID0gMDsKICAgICAgICAgICAgaW50IGxlZnQgPSAwOwogICAgICAgICAgICBpbnQgbSA9IChpbnQpcG9zaXRpb25zX3ZlYy5zaXplKCk7CiAgICAgICAgICAgIGZvciAoaW50IHJpZ2h0ID0gMDsgcmlnaHQgPCBtOyByaWdodCsrKSB7CiAgICAgICAgICAgICAgICAvLyBsZW5ndGggb2Ygc3ViYXJyYXkgYmV0d2VlbiBwb3NpdGlvbnNfdmVjW2xlZnRdIGFuZCBwb3NpdGlvbnNfdmVjW3JpZ2h0XQogICAgICAgICAgICAgICAgaW50IGxlbiA9IHBvc2l0aW9uc192ZWNbcmlnaHRdIC0gcG9zaXRpb25zX3ZlY1tsZWZ0XSArIDE7CiAgICAgICAgICAgICAgICBpbnQgZnJlcSA9IHJpZ2h0IC0gbGVmdCArIDE7CiAgICAgICAgICAgICAgICB3aGlsZSAobGVmdCA8IHJpZ2h0ICYmIGZyZXEgLSAoKGxlbiArIDEpIC8gMikgPCAwKSB7CiAgICAgICAgICAgICAgICAgICAgbGVmdCsrOwogICAgICAgICAgICAgICAgICAgIGxlbiA9IHBvc2l0aW9uc192ZWNbcmlnaHRdIC0gcG9zaXRpb25zX3ZlY1tsZWZ0XSArIDE7CiAgICAgICAgICAgICAgICAgICAgZnJlcSA9IHJpZ2h0IC0gbGVmdCArIDE7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoZnJlcSAtICgobGVuICsgMSkgLyAyKSA+IG1heF9rKSB7CiAgICAgICAgICAgICAgICAgICAgbWF4X2sgPSBmcmVxIC0gKChsZW4gKyAxKSAvIDIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXMucHVzaF9iYWNrKG1heF9rKTsKICAgICAgICB9CgogICAgICAgIGZvciAoc2l6ZV90IGkgPSAwOyBpIDwgcmVzLnNpemUoKTsgaSsrKSB7CiAgICAgICAgICAgIGlmIChpID4gMCkgY291dCA8PCAnICc7CiAgICAgICAgICAgIGNvdXQgPDwgcmVzW2ldOwogICAgICAgIH0KICAgICAgICBjb3V0IDw8ICdcbic7CiAgICB9CgogICAgcmV0dXJuIDA7Cn0K' | base64 -d > /app/main.cpp", 'Enter']
['asciinema rec --stdin /logs/tests.cast', 'Enter']
['clear', 'Enter']
['bash ', '/tests/run-tests.sh', 'Enter']
['C-d']
['C-d']
